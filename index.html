<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>Socket.io</title>
    </head>
 
    <body>
        <h1>Communication avec socket.io !</h1>

        <p><input type="text" placeholder="Votre message..." id="message" autofocus/>
            <button id="submit" type="submit" onclick="log()">Envoyer</button>
        </p>

        <ul id="Result">
        </ul>

        <script src="/socket.io/socket.io.js"></script>
        <script>
            document.getElementById("message").addEventListener("keyup", function(event) {
                event.preventDefault();
                if (event.keyCode === 13) {
                    document.getElementById("submit").click();
                }
            });

            var socket = io.connect('http://localhost:8080');

            var pseudo = prompt('Quel est votre pseudo ?');
            socket.emit('join', pseudo);
            document.title = pseudo + ' - Super chat temps r√©el'

            socket.on('join', function(nickname) {
                var textnode = document.createTextNode(nickname + ' joined');
                appendChild(textnode);
            })

            .on('left', function(nickname) {
                var textnode = document.createTextNode(nickname + ' has left');
                appendChild(textnode);
            })

            .on('message', function(source) {
                var textnode = document.createTextNode(source.username + ' ' + source.message);
                appendChild(textnode);
            });

            function log(){
                var messageObject = document.getElementById("message");
                var message = messageObject.value;
                messageObject.value = '';
                document.getElementById("message").value;
                socket.emit('message', message);
                var textnode = document.createTextNode(pseudo + ' ' + message);            
                appendChild(textnode);
                messageObject.focus();
            }

            function appendChild(child) {
                var node = document.createElement("LI");
                node.appendChild(child);
                document.getElementById("Result").appendChild(node); 
            }
        </script>
    </body>
</html>
<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>Socket.io</title>
        <style>
            LI.message {
                text-decoration: none; 
                background-color: black;
                color: rgb(255, 0, 0);
                }
            LI.joinleft {
                font-style: italic;
                color:grey;
            }
        </style>
    </head>
 
    <body>
        <h1>Communication avec socket.io !</h1>

        <p><input type="text" placeholder="Votre message..." id="message" autofocus/>
            <button id="submit" type="submit" onclick="log()">Envoyer</button>
        </p>

        <ul id="Result" style="list-style-type:none">
        </ul>

        <script src="/socket.io/socket.io.js"></script>
        <script>
            document.getElementById("message").addEventListener("keyup", function(event) {
                event.preventDefault();
                if (event.keyCode === 13) {
                    document.getElementById("submit").click();
                }
            });

            var socket = io.connect('http://localhost:8080');

            var pseudo = prompt('Quel est votre pseudo ?');
            socket.emit('join', pseudo);
            document.title = pseudo + ' - Super chat temps r√©el'

            socket.on('join', function(nickname) {
                var italicNode = document.createElement("i");
                var textnode = document.createTextNode(nickname + ' joined');
                italicNode.appendChild(textnode)
                appendChild(italicNode);
            })

            .on('left', function(nickname) {
                var italicNode = document.createElement("i");
                var textnode = document.createTextNode(nickname + ' has left');
                italicNode.appendChild(textnode)
                appendChild(italicNode);
            })

            .on('message', function(source) {
                var groupNode = document.createElement();

                var styleNode = document.createElement(a);
                styleNode.appendChild(document.createTextNode(source.username));
                groupNode.appendChild(styleNode);
                groupNode.appendChild(document.createTextNode(source.message));
                appendChild(groupNode);
            });

            function log(){
                var messageObject = document.getElementById("message");
                var message = messageObject.value;
                messageObject.value = '';
                document.getElementById("message").value;
                socket.emit('message', message);
                var textnode = document.createTextNode(pseudo + ' ' + message);            
                appendChild(textnode);
                messageObject.focus();
            }

            function appendChild(child) {
                var node = document.createElement("LI");
                node.setAttribute("class", "message");
                node.appendChild(child);
                document.getElementById("Result").appendChild(node); 
            }
        </script>
    </body>
</html>